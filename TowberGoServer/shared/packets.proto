syntax = "proto3";
package packets;

option go_package = "pkg/packets";


message LoginRequestMessage{
  string username = 1;
  string password = 2;
}

message RegisterRequestMessage{
  string username = 1;
  string password = 2;
}

message OKResponseMessage{}

message DenyResponseMessage{
  string reason = 1;
}

message LoginSuccessMessage{
  string username = 1;
  uint32 uid = 2;
}

message PlayerEnterAreaRequestMessage{
  string area_name = 1;
  uint32 entrance_id = 2;
}

message PlayerEnterAreaResponseMessage{
  string area_name = 1;
  bool success = 2;
  string reason = 3;
}

message PlayerEnterAreaMessage{
  string username = 2;
  float x = 3;
  float y = 4;
}

message PlayerLeaveAreaMessage{}

message PlayerMoveMessage{
  float from_x = 1;
  float from_y = 2;
  float to_x = 3;
  float to_y = 4;
}

message ChatMessage{
  string content = 1;
  string username = 2;
  uint32 type = 3; // 记录当前聊天内容的类型，0为当前区域，1为全局
}

message MailRequestMessage{}

message MailMessage{
  uint32 id = 1;
  string titles = 2;
  string contents = 3;
  string sender = 4;
  repeated ItemMessage items = 5;
  repeated PetItemMessage pet_items = 6;
}

message MailCollectMessage{
  uint32 id = 1;
}

message MailCollectResponseMessage{
  bool success = 1;
  string reason = 2;
  uint32 id = 3;
}

message MailDeleteMessage{
  uint32 id = 1;
}

message ItemMessage{
  uint32 id = 1;
  int64 count = 2;
}

message BagRequestMessage{}

message BagMessage{
  repeated uint32 id = 1;
  repeated int64 count = 2;
}

message AddBagItemMessage{
  uint32 id = 1;
  int64 count = 2;
  bool compensate = 3;
}

message DeleteBagItemMessage{
  uint32 id = 1;
  int64 count = 2;
}

message UseBagItemRequestMessage{
  uint32 id = 1;
  int64 count = 2;
}

message UseBagItemResponseMessage{
  bool success = 1;
  string reason = 2;
}

//----------------------------------------宠物背包-----------------------

message GetPetMessage{
  uint32 id = 1;
  bool equipped = 2; // 是否被装备
}

message PetBagRequestMessage{}

message PetBagResponseMessage{
  repeated PetMessage pet = 1;
}

message PetMessage{
  uint32 pet_id = 1;
  uint64 id = 2;
  int64 exp = 3;
  int64 level =4;
  repeated uint32 equipped_skills = 5;
  PetStatsMessage pet_stats = 6;
}

message PetStatsMessage{
  int64 max_hp = 1;
  int64 hp = 2;
  int64 max_mana = 3;
  int64 mana = 4;
  int64 strength = 5;
  int64 intelligence = 6;
  int64 speed = 7;
  int64 defense = 8;
}

message SavePetMessage{}

message LearnSkillRequestMessage{
  int64 position = 1;
  uint32 skill_id = 2;
  uint64 pet_id = 3;
}

message LearnSkillResponseMessage{
  bool success = 1;
  string reason = 2;
}

message EquippedPetInfoRequestMessage{
  uint64 id = 1;
}

message EquippedPetInfoResponseMessage{
  uint64 id = 1;
  PetMessage pet = 2;
}

//----------------------------------宠物道具背包-------------------------
message AddPetItemMessage{
  uint32 id = 1;
  int64 count = 2;
  bool compensate = 3;
}

message DeletePetItemMessage{
  uint32 id = 1;
  int64 count = 2;
}

message PetItemMessage{
  uint32 id = 1;
  int64 count = 2;
}

message PetItemBagRequestMessage{}

message PetItemBagResponseMessage{
  repeated uint32 id = 1;
  repeated int64 count = 2;
}

message UsePetItemRequestMessage{
  uint32 id = 1;
  uint64 pet_id = 2;
  int64 count = 3;
}

message UsePetItemResponseMessage{
  bool success = 1;
  string reason = 2;
}

//---------------------------------------------------------------------
message BattleRequestMessage{
  uint32 target = 1;
}

message BattleInvitingMessage{
  uint32 roomID = 1;
  string user_name = 2;
}


message BattleInvitingResponseMessage{
  uint32 roomID = 1;
  bool accepted = 2;
}

message StartBattleMessage{
  int64 number = 1;
}


//---------------------------------------------------------------------
message Packet{
  uint32 uid = 1;
  oneof msg{
    LoginRequestMessage login_request = 2;
    RegisterRequestMessage register_request = 3;
    OKResponseMessage ok_response = 4;
    DenyResponseMessage deny_response = 5;
    LoginSuccessMessage login_success = 6;
    PlayerEnterAreaMessage player_enter = 7;
    PlayerLeaveAreaMessage player_leave = 8;
    PlayerMoveMessage player_movement = 9;
    PlayerEnterAreaRequestMessage player_enter_request = 10;
    ChatMessage chat = 11;
    PlayerEnterAreaResponseMessage player_enter_area_response = 12;
    MailMessage mail = 13;
    MailRequestMessage mail_request = 14;
    MailCollectMessage mail_collect = 15;
    MailDeleteMessage mail_delete = 16;
    MailCollectResponseMessage mail_collect_response = 17;
    BagRequestMessage bag_request = 18;
    BagMessage bag = 19;
    AddBagItemMessage add_bag_item = 20;
    DeleteBagItemMessage delete_bag_item = 21;
    UseBagItemRequestMessage use_bag_item_request = 22;
    UseBagItemResponseMessage use_bag_item_response = 23;
    UiPacket ui_packet = 24;
    GetPetMessage get_pet = 25;
    PetBagRequestMessage pet_bag_request = 26;
    PetBagResponseMessage pet_bag_response = 27;
    SavePetMessage save_pet = 28;
    LearnSkillRequestMessage learn_skill_request = 29;
    LearnSkillResponseMessage learn_skill_response = 30;
    AddPetItemMessage add_pet_item = 31;
    DeletePetItemMessage delete_pet_item = 32;
    PetItemBagRequestMessage pet_item_bag_request = 33;
    UsePetItemRequestMessage use_pet_item_request = 34;
    UsePetItemResponseMessage use_pet_item_response = 35;
    PetItemBagResponseMessage pet_item_bag_response = 36;
    EquippedPetInfoRequestMessage equipped_pet_info_request = 37;
    EquippedPetInfoResponseMessage equipped_pet_info_response = 38;
    BattlePacket battle_packet = 39;
    BattleRequestMessage battle_request = 40;
    BattleInvitingResponseMessage battle_inviting_response = 41;
    BattleInvitingMessage battle_inviting = 42;
    StartBattleMessage start_battle = 43;
  }
}

message UiPacket{
  oneof msg {
    OpenUIMessage open_ui = 1;
    InitialPetRequestMessage initial_pet_request = 2;
  }
}

message OpenUIMessage{
  string path = 1;
}

message InitialPetRequestMessage{
  uint32 request_id = 1;
}

//--------------------------------------战斗系统------------------------
message BattlePacket{
  oneof msg{
    RoundCommandMessage command = 1;
    AttackStatsMessage attack_stats = 2;
    DenyCommandMessage deny_command = 3;
    StartNextRoundMessage start_next_round = 4;
    BattleEndMessage battle_end = 5;
    RoundConfirmMessage round_confirm = 6;
    ChangePetResponseMessage change_pet = 7;
    ChangePetRequestMessage change_pet_request = 8;
    SyncBattleInformationMessage sync_battle_information = 9;
    RoundEndMessage round_end = 10;
  }
}

message RoundCommandMessage{
  oneof command{
    ChangePet change_pet = 1;
    RunAway runaway = 2;
    Attack attack = 3;
  }
}

message ChangePet{
  int64 pet_position = 1;
}

message RunAway{}

message Attack{
  int64 skill_pos = 1;
}

message AttackStatsMessage{
  int64 number = 1;
  uint32 skill_id = 2;
  int64 physical_damage = 3;
  int64 magic_damage = 4;
  repeated Buff buffs = 5;
  repeated PetStatsMessage pet_stats = 6;
}

message Buff{
  uint32 id = 1;
  int64 level = 2;
}

message BattleEndStats{}

message DenyCommandMessage{
  string reason = 1;
}

message StartNextRoundMessage{}

message BattleEndMessage{
  int64 winner = 1;
}

// 当客户端回合播放完毕后发送此消息
message RoundConfirmMessage{}

// 更换宠物请求
message ChangePetRequestMessage{}

// 更换宠物
message ChangePetResponseMessage{
  int64 pet_position = 2;
}

// 同步双方的信息
message SyncBattleInformationMessage{
  int64 number = 1;
  string player_name = 2;
  repeated PetMessage pet_messages = 3;
}

message RoundEndMessage{}